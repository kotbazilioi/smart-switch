#include <string.h>
#include "html_page.h"
#include "flash_if.h"
uint8_t ct_logoff_time;
uint8_t flag_logon=0;
static const char http_html_hdr[] = "HTTP/1.1 200 OK\r\nContent-type: text/html\r\n\r\n";
  //char * data[]="<a href=\"settings.html\" target=\"_self\" rel=\"nofollow\">????????? &emsp; </a>";
static const char http_html_start_constr[] = "\<!DOCTYPE html> <body onload=\"onload()\"\>  <a href=\"http:\/\/www.netping.ru/\"><img src=\"img/netping.gif\" height=\"59\" width=\"169\" border=\"0\" alt=\"netping logo\" title=\"404 error\"></a> <html><head><meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" />\<script\>"
	  "var xhr\;"
           "var idTimer1\";"
	   "function onload(){"
	   "xhr = new (XMLHttpRequest);"
	   "}"
           
	   "function swich1(){"
           "xhr.open(\"GET\", \"swich?c=1\", true);"
	   "xhr.responseType = \"text\";"
	   "xhr.send(null);"
	   "}"	
	  "function swich2(){"
	  "xhr.open(\"GET\", \"swich?c=2\", true);"
	  "xhr.responseType = \"text\";"
	  "xhr.send(null);"
	  "}"
	  "function swich3(){"
	   "xhr.open(\"GET\", \"swich?c=3\", true);"
	    "xhr.responseType = \"text\";"
	    "xhr.send(null);"
	  "}"
"</script>";


static const char http_html_style[] = 
"<title>Fon DRV</title>"
"  <style>"
"    lf {"
	"font-family: Courier; /* Гарнитура шрифта */"
	"src: url(fonts/Courier.ttf); /* Путь к файлу со шрифтом */"
///////////////	"font-family: Courier, 'Comic Sans MS', cursive;"
        "text-align: center;"
          "font-size: 16pt;"
    "}"
    "h2 {"
	"font-size: 14pt;"
        "text-align: center;"
    "}"
      
     "h3 {"
      //  "text-decoration: underline;"
        "border-bottom: 1px solid Seagreen;"/* Параметры линии под текстом */
        "font-weight: normal;" /* Убираем жирное начертание */
        "padding-bottom: 1px;" /* Расстояние от текста до линии */
	"font-size: 12pt;"
        "text-align: left;"
      "}"      
   "display: inline-block;"
  "</style>"
    "</head>";
uint8_t pass_compar(char* in_buf)
{
uint8_t ct_pass;
uint8_t len_login,len_pass;
char login_in[32] = {0};
char pass_in[32]= {0};
for(ct_pass=23;ct_pass<120;ct_pass++)
  {
    if (((char)(*(in_buf+ct_pass)))=='&')
      {
       len_login = ct_pass-23;
      }
    if (in_buf[ct_pass]==' ')
      {
        len_pass=ct_pass-23-len_login-10;
        ct_pass=120;
      }
   
  }
    memcpy(login_in,(char*)(in_buf+23),len_login);
    memcpy(pass_in,(char*)(in_buf+23+len_login+10),len_pass);
    if (((strncmp((char*)FW_data.V_LOGIN,(char*)login_in,len_login))==0)&&((strncmp((char*)FW_data.V_PASSWORD,(char*)pass_in,len_pass))==0))
    {
      return 1;
    }
return 0;
}



uint16_t set_open_block (char* str1,char* name)
{ 

uint16_t len=strlen((char*)name)+2;
sprintf(str1,"<%s>",name);
return len;
}
uint16_t reset_open_block (char* str1,char* name)
{ 

uint16_t len=strlen(name)+3;
sprintf(str1,"<%s/>",name);
return len;
}
uint16_t set_space (char* str1,uint8_t n)
{ 
uint16_t len=6*n;
 memset (str1,0, 64);
for(;n>0;n--)
{
  strcat(str1,"&ensp;");
}

return len;
}
uint16_t set_tab (char* str1,uint8_t n)
{ 
uint16_t len=6*n;
 memset (str1,0, 64);
for(;n>0;n--)
{
  strcat(str1,"&ensp;");
}

return len;
}
uint16_t set_link (char* str1,char* name,char* link)
{
  //<a href="" target="_self" rel="nofollow">&emsp; </a>
    
//char str2[64];  
uint16_t len=strlen(name)+strlen(link)+52;  //<a href="" target="_self" rel="nofollow">&emsp; </a>
sprintf(str1,"<a href=\"%s\" target=\"_self\" rel=\"nofollow\">%s&emsp; </a>",link,name);

////strcat(str1,"<a href=\"");
////
////sprintf(str2,"%s",link);
////strcat(str1,str2);
////
////strcat(str1,"\" target=\"_self\" rel=\"nofollow\">");
////
////sprintf(str2,"%s",name);
////strcat(str1,str2);
////
////strcat(str1,"&emsp; </a>");

return len;
}

uint16_t set_intext (char* str1,char* name,char* size,char* value)
{ 

///<input type="text" name="IP_addres"  size='15' value="192.168.000.122">&ensp;
///<input type="text" name=""  size='' value="">&ensp;
uint16_t len=51;
len +=strlen(name);
len+= strlen(value);
len+=strlen(size);
sprintf(str1,"<input type=\"text\" name=\"%s\"  size='%s' value=\"%s\">&ensp;",name,size,value);

////sprintf(str2,"%s",name);
////strcat(str1,str2);
////
////sprintf(str1,"\"  size='");
////
////sprintf(str2,"%s",size);
////strcat(str1,str2);
////
////sprintf(str1,"<' value=\"");
////
////sprintf(str2,"%s",value);
////strcat(str1,str2);
////
////sprintf(str1,"\">&ensp;");

return len;
}


uint32_t costr_page1(char* str1)
{
  uint32_t len;
  char str2[256];
  //str1=(char*)malloc(4000);
  memset (str1,0, 4000);
  len = sizeof(http_html_start_constr);
  strcat(str1,http_html_start_constr);
  
  len = len+sizeof(http_html_style);
  strcat(str1,http_html_style);
  
  len=len+set_open_block(str2,"body");
  strcat(str1,str2);
  
  len=len+set_open_block(str2,"ul");
  strcat(str1,str2);
  
  len=len+set_open_block(str2,"lf");
  strcat(str1,str2);
  
  len=len+set_open_block(str2,"h4");
  strcat(str1,str2);
  
  len=len+sizeof("Драйвер лампы и фона HW2.0 ");
  strcat(str1,"Драйвер лампы и фона HW2.0 ");
  
  len=len+reset_open_block(str2,"h4");
  strcat(str1,str2);
  
  len=len+reset_open_block(str2,"lf");
  strcat(str1,str2);
  
  len=len+set_open_block(str2,"h2");
  strcat(str1,str2);
  
  
  len=len+set_link(str2,"Настройки ","settings.html");
  strcat(str1,str2);
  
  len=len+set_link(str2,"Текущие данные ","data_strim.html");
  strcat(str1,str2);  
    
  len=len+reset_open_block(str2,"h2");
  strcat(str1,str2);

  len=len+reset_open_block(str2,"ul");
  strcat(str1,str2);
  
  len=len+set_open_block(str2,"form action='/' method='GET'");
  strcat(str1,str2);
  
    len=len+set_open_block(str2,"ul");
  strcat(str1,str2);
  
  
  len=len+set_open_block(str2,"h2");
  strcat(str1,str2);
  
  len=len+set_open_block(str2,"br");
  strcat(str1,str2);


  len=len+set_space(str2,6);
  strcat(str1,str2);  

  len=len+set_open_block(str2,"b>IP addres</b");
  strcat(str1,str2);

  len=len+set_intext(str2,"IP_addres","15","192.168.000.122");
  strcat(str1,str2);
  
  len=len+set_space(str2,6);
  strcat(str1,str2);  
  
   len=len+set_open_block(str2,"b>MASK addres</b");
  strcat(str1,str2);

  len=len+set_intext(str2,"MASK_addres","15","255.255.255.000");
  strcat(str1,str2);

    
  len=len+set_space(str2,6);
  strcat(str1,str2);  
  
   len=len+set_open_block(str2,"b>IP getway</b");
  strcat(str1,str2);
  
  
  len=len+set_intext(str2,"IP_getway","15","192.168.000.001");
  strcat(str1,str2);  
  
  len=len+reset_open_block(str2,"h2");
  strcat(str1,str2);
  
  len=len+reset_open_block(str2,"ul");
  strcat(str1,str2);
  
  len=len+reset_open_block(str2,"form");
  strcat(str1,str2);
  
  return len;
};

uint32_t costr_page2(char* str1)
{
  uint32_t len;
  char str2[256];
  //str1=(char*)malloc(4000);
  memset (str1,0, 4000);
  len = sizeof(http_html_start_constr);
  strcat(str1,http_html_start_constr);
  
  len = len+sizeof(http_html_style);
  strcat(str1,http_html_style);
  
  len=len+set_open_block(str2,"body");
  strcat(str1,str2);
  
  len=len+set_open_block(str2,"ul");
  strcat(str1,str2);
  
  len=len+set_open_block(str2,"lf");
  strcat(str1,str2);
  
  len=len+set_open_block(str2,"h4");
  strcat(str1,str2);
  
  len=len+sizeof("Интеллектуальная розетка DKST 59 v");
  strcat(str1,"Интеллектуальная розетка DKST 59 v");
  //FW_data
  
  
  len=len+reset_open_block(str2,"h4");
  strcat(str1,str2);
  
  len=len+reset_open_block(str2,"lf");
  strcat(str1,str2);
  
  len=len+set_open_block(str2,"h2");
  strcat(str1,str2);
  
  
  len=len+set_link(str2,"Главная","index.html");
  strcat(str1,str2);
  
  len=len+set_link(str2,"Настройки ","settings.html");
  strcat(str1,str2);
  
  len=len+set_link(str2,"Расписание ","rasp.html");
  strcat(str1,str2);
  
  len=len+set_link(str2,"Сторож","watchdog.html");
  strcat(str1,str2);
  
  
  len=len+set_link(str2,"E-mail","email.html");
  strcat(str1,str2);  
  
  len=len+set_link(str2,"Прошивка","update.html");
  strcat(str1,str2);  
  
  len=len+set_link(str2,"Жирнал ","logs.html");
  strcat(str1,str2);  
    
  len=len+reset_open_block(str2,"h2");
  strcat(str1,str2);

  len=len+reset_open_block(str2,"ul");
  strcat(str1,str2);
  
  len=len+set_open_block(str2,"form action='/' method='GET'");
  strcat(str1,str2);
  
    len=len+set_open_block(str2,"ul");
  strcat(str1,str2);
  
  
  len=len+set_open_block(str2,"h3");
  strcat(str1,str2);
  
  len=len+set_open_block(str2,"br");
  strcat(str1,str2);

  len=len+sizeof("Интеллектуальная розетка DKST 59 v");
  strcat(str1,"Интеллектуальная розетка DKST 59 v");
  
  len=len+set_space(str2,3);
  strcat(str1,str2);
  
    len=len+sizeof("Интеллектуальная розетка DKST 59 v");
  strcat(str1,"Интеллектуальная розетка DKST 59 v");
  
  
  
////////  len=len+set_space(str2,6);
////////  strcat(str1,str2);  
////////
////////  len=len+set_open_block(str2,"b>IP addres</b");
////////  strcat(str1,str2);
////////
////////  len=len+set_intext(str2,"IP_addres","15","192.168.000.122");
////////  strcat(str1,str2);
////////  
////////  len=len+set_space(str2,6);
////////  strcat(str1,str2);  
////////  
////////   len=len+set_open_block(str2,"b>MASK addres</b");
////////  strcat(str1,str2);
////////
////////  len=len+set_intext(str2,"MASK_addres","15","255.255.255.000");
////////  strcat(str1,str2);
////////
////////    
////////  len=len+set_space(str2,6);
////////  strcat(str1,str2);  
////////  
////////   len=len+set_open_block(str2,"b>IP getway</b");
////////  strcat(str1,str2);
////////  
////////  
////////  len=len+set_intext(str2,"IP_getway","15","192.168.000.001");
////////  strcat(str1,str2);  
  
  len=len+reset_open_block(str2,"h3");
  strcat(str1,str2);
  
  len=len+reset_open_block(str2,"ul");
  strcat(str1,str2);
  
  len=len+reset_open_block(str2,"form");
  strcat(str1,str2);
  
 // free(str1);
  return len;
};


